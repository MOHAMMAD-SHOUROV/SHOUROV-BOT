module.exports.config = {
    name: 'admins',
    version: '1.0.1',
    permission: 0,
    credits: 'shourov',
    prefix: false,
    description: 'group administrator list.',
    category: 'without prefix',
    usages: 'admins',
    cooldowns: 5,
    dependencies: []
};

module.exports.run = async function({ api, event, args, Users }) {
    try {
        const threadInfo = await api.getThreadInfo(event.threadID);
        const adminIDs = threadInfo.adminIDs || [];

        if (!adminIDs.length) {
            return api.sendMessage("This group has no administrators (or I couldn't fetch admin list).", event.threadID, event.messageID);
        }

        let listad = '';
        let index = 1;

        // Use for...of so we can await inside loop
        for (const admin of adminIDs) {
            try {
                // prefer Users.getNameUser if available (faster / cached), fallback to api.getUserInfo
                let name = "";
                if (typeof Users?.getNameUser === "function") {
                    try {
                        name = await Users.getNameUser(admin.id);
                    } catch (e) {
                        // fallback
                    }
                }
                if (!name) {
                    const info = await api.getUserInfo(admin.id);
                    name = info[admin.id] && info[admin.id].name ? info[admin.id].name : admin.id;
                }
                listad += `${index++}. ${name}\n`;
            } catch (e) {
                // if fetching a particular admin failed, still continue
                listad += `${index++}. ${admin.id} (failed to fetch name)\n`;
            }
        }

        return api.sendMessage(
            `List of ${adminIDs.length} administrator(s):\n${listad}`,
            event.threadID,
            event.messageID
        );
    } catch (err) {
        console.error(err);
        return api.sendMessage("An error occurred while fetching admin list.", event.threadID, event.messageID);
    }
};
